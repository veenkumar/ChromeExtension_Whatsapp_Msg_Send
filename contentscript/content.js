var e,t,n=[],a={load:function(){sendMessage({command:"checkSearchStatus"},function(e){e&&e.is_search&&1==e.is_search&&a.initAutoBotProcess()})},onExtMessage:function(e,t,n){switch(a.message=e,e.command){case"removeBlocker":a.removeBlocker();break;case"getWGrroupNumbers":a.getWGrroupNumbers(e,t,n);break;case"checkLastAttachment":a.checkLastAttachment(e,t,n);break;case"openSelfChat":a.openSelfChat(e,t,n);break;case"checkInjectJs":n(!0);break;case"startGroupSendingMsg":$("#pane-side").animate({scrollTop:0}),a.load();break;case"startPersonSendingMsg":a.load()}return!0},addEvents:function(e,t,n){},initAutoBotProcess:function(e,t,n){sendMessage({command:"getSettings"},function(e){var t,n,s;a.uiSettings=e.uiSettings,t=a.uiSettings.scrape_status,n=a.uiSettings.group_sender_status||"Finished","Inprogress"!=t&&"Inprogress"!=n||(a.createBlocker(),s=setInterval(function(){1==$("#side:eq(0):visible").is(":visible")&&(clearInterval(s),a.startAutoBotProcess())},1e3))})},startAutoBotProcess:function(){sendMessage({command:"updateScrapeState"},function(e){}),sendMessage({command:"getSettings"},function(e){var t;a.uiSettings=e.uiSettings,t=a.uiSettings.interval_break_seconds,sendMessage({command:"set_delay_in_bg",timeout:a.get_time_break_delay(t)},function(){sendMessage({command:"getSettings"},function(e){var t,n,s,o;if(a.uiSettings=e.uiSettings,t=a.uiSettings.scrape_status,n=a.uiSettings.group_sender_status||"Finished",a.uiSettings.scrapped_items_arr||[],"Inprogress"==t)return s=a.uiSettings.userFreeTrialStarted,o=a.uiSettings.current_processed_count,1==s&&o>=25?(sendMessage({command:"stopAutoBotProcess",reason:"upgrade_require"},function(e){}),!1):(a.getCurrentNumber(function(e,t){sendMessage({command:"set_delay_in_bg",timeout:1e3},async function(){var n,s,o,r,i,c,u,d,l,m;if(""==e)return sendMessage({command:"stopAutoBotProcess",reason:"next_profile_not_found"},function(e){}),!1;n=a.uiSettings.message_input,s=a.uiSettings.attachment_input,o=n.replace(/{name}/g,t),r=getFormattedTime(),o=o.replace(/{date}/g,r),i=Math.random().toString(36).substr(2,11).toUpperCase(),o=o.replace(/{message_id}/g,i),c=String(e),1==s?(u=Promise.resolve(),d=String(e).replace("+",""),u=u.then(()=>forwardLastMsgtoPhone(d,o)).then(e=>{var t,n;e?(t=a.uiSettings.total_scrapped_count,n=a.uiSettings.current_processed_count,t=parseInt(t)+1,n=parseInt(n)+1,a.uiSettings.total_scrapped_count=t,a.uiSettings.current_processed_count=n,sendMessage({command:"saveUISettings",data:a.uiSettings},function(e){sendMessage({command:"set_delay_in_bg",timeout:1e3},function(){a.processNetKeyword(!0)})})):sendMessage({command:"set_delay_in_bg",timeout:1e3},function(){a.processNetKeyword(!1)})})):await smP(c.replace("+",""),o)?(l=a.uiSettings.total_scrapped_count,m=a.uiSettings.current_processed_count,l=parseInt(l)+1,m=parseInt(m)+1,a.uiSettings.total_scrapped_count=l,a.uiSettings.current_processed_count=m,sendMessage({command:"saveUISettings",data:a.uiSettings},function(e){sendMessage({command:"set_delay_in_bg",timeout:1e3},function(){a.processNetKeyword(!0)})})):sendMessage({command:"set_delay_in_bg",timeout:1e3},function(){a.processNetKeyword(!1)})})}),!1);"Inprogress"==n&&a.startGroupSender(1)})})})},startGroupSender:function(e){var t,n;sendMessage({command:"updateScrapeState"},function(e){}),t=$("#pane-side"),n=e,sendMessage({command:"getSettings"},function(e){var s,o,r;if(a.uiSettings=e.uiSettings,s=a.uiSettings.scrapped_items_arr,t.scrollTop()==n)return sendMessage({command:"stopAutoBotProcess",reason:"next_profile_not_found"},function(e){}),!1;if(o=[],$('#pane-side [data-icon="default-group"]').each(function(){var e,t,n="";-1!=(n=(n=$(this).closest('[role="option"]').length>0?$(this).closest('[role="option"]').parent().attr("style"):$(this).closest('[role="row"]').length>0?$(this).closest('[role="row"]').parent().attr("style"):$(this).closest("._1Ux09").attr("style"))||"").indexOf("transform: translateY")&&(e=n.split("transform: translateY")[1]||0,t=String(e).replace(/[^0-9]/g,"")||0,o.push({$ele:$(this),transform:parseInt(t)}))}),o.sort(function compare(e,t){return e.transform>t.transform?1:t.transform>e.transform?-1:0}),console.log("all_visible_group_arr >> ",o),o.length>0){o=o.reverse(),function startSendGroupMsg(){var e,n,r,i,c;o.length>0?(e=o.pop(),0==(n=$(e.$ele).closest('[role="option"]')).length&&(n=$(e.$ele).closest('[role="row"]')),0==n.length&&(n=$(e.$ele).closest("._1Ux09")),r=n.find('span[dir="auto"]').attr("title"),i=a.check_group_send_statuc(r,s),n.length>0&&n.find("div:eq(0)").length>0?0==i?sendMessage({command:"set_delay_in_bg",timeout:1e3},function(){var e={name:r,status:"Pending"};sendMessage({command:"getSettings"},function(t){var s,o,r;a.uiSettings=t.uiSettings,s=a.uiSettings.group_message_input,a.uiSettings.current_processed_count,o=a.uiSettings.group_sender_status||"Finished",r=a.uiSettings.interval_break_seconds,"Inprogress"==o&&sendMessage({command:"set_delay_in_bg",timeout:a.get_time_break_delay(r)},function(){if(n.find("._2nY6U:eq(0)").length>0){n.find("._2nY6U:eq(0)").vmousedown();var t=setInterval(function(){1==$("#main:eq(0):visible").is(":visible")&&(clearInterval(t),$('#main [contenteditable="true"]:eq(0)').length>0?($('#main [contenteditable="true"]:eq(0)').html(s),$('#main [contenteditable="true"]:eq(0)').vTextEvent(),$('#main footer [data-icon="send"]:visible').length>0?($('#main footer [data-icon="send"]:visible').click(),a.save_group_info(!0,e,function(){startSendGroupMsg()})):a.save_group_info(!1,e,function(){startSendGroupMsg()})):a.save_group_info(!1,e,function(){startSendGroupMsg()}))},1e3)}else startSendGroupMsg()})})}):startSendGroupMsg():(c=t.scrollTop(),t.stop().animate({scrollTop:t.scrollTop()+1e3},"slow"),sendMessage({command:"set_delay_in_bg",timeout:1e3},function(){a.startGroupSender(c)}))):(c=t.scrollTop(),t.stop().animate({scrollTop:t.scrollTop()+1e3},"slow"),sendMessage({command:"set_delay_in_bg",timeout:1e3},function(){a.startGroupSender(c)}))}()}else r=t.scrollTop(),t.stop().animate({scrollTop:t.scrollTop()+1e3},"slow"),sendMessage({command:"set_delay_in_bg",timeout:1e3},function(){a.startGroupSender(r)})})},save_group_info:function(e,t,n){t.status=1==e?"Sent":"Failed",t.date=new Date,sendMessage({command:"getSettings"},function(s){var o,r,i;a.uiSettings=s.uiSettings,(o=a.uiSettings.scrapped_items_arr||[]).push(t),1==e&&(r=a.uiSettings.total_scrapped_count,i=a.uiSettings.current_processed_count,r=parseInt(r)+1,i=parseInt(i)+1,a.uiSettings.total_scrapped_count=r,a.uiSettings.current_processed_count=i),a.uiSettings.scrapped_items_arr=o,sendMessage({command:"saveUISettings",data:a.uiSettings},function(e){sendMessage({command:"updateScrapeState"},function(e){}),n()})})},get_time_break_delay:function(e){return 1e3*parseInt(e)},check_group_send_statuc:function(e,t){var n,a=!1;for(n=0;n<t.length;n++)if(t[n].name==e){a=!0;break}return a},processNetKeyword:function(e){a.getNetKeyword(e,function(e,t){return""!=e?(a.startAutoBotProcess(),!1):(sendMessage({command:"stopAutoBotProcess",reason:"next_profile_not_found"},function(e){}),!1)})},getNetKeyword:function(e,t){sendMessage({command:"getSettings"},function(n){var s,o,r,i,c;for(a.uiSettings=n.uiSettings,s=a.uiSettings.scrapped_items_arr,o="",r="",[],i=0;i<s.length;i++)if("Inprogress"==s[i].status){s[i].status=1==e?"Sent":"Failed",s[i].date=new Date;break}for(c=0;c<s.length;c++)if("Pending"==s[c].status){s[c].status="Inprogress",o=s[c].number,r=s[c].name;break}a.uiSettings.scrapped_items_arr=s,sendMessage({command:"saveUISettings",data:a.uiSettings},function(e){t(o,r),sendMessage({command:"updateScrapeState"},function(e){})})})},getCurrentNumber:function(e){sendMessage({command:"getSettings"},function(t){var n,s,o,r;for(a.uiSettings=t.uiSettings,n=a.uiSettings.scrapped_items_arr,s="",o="",r=0;r<n.length;r++)if("Inprogress"==n[r].status){s=n[r].number,o=n[r].name;break}e(s,o)})},clickNextPage:function(){var e,t=$("a#pnnext:eq(0)");t.length>0?(t[0].click(),e=setInterval(function(){0==$(".rlfl__loading-overlay.rlfl__visible:eq(0):visible").is(":visible")&&(clearInterval(e),a.initAutoBotProcess())},1e3)):sendMessage({command:"stopAutoBotProcess",reason:"next_profile_not_found"},function(e){})},parseQueryString:function(e){var t,n,a,s,o={};for(a=0,s=(t=e.replace("?","&").split("&")).length;a<s;a++)o[(n=t[a].split("="))[0]]=n[1];return o},createBlocker:function(){$("#blocker").remove(),$("html body").prepend('<div style="width: 100%;height: 100%; top:0; left: 0; background-color: #000;opacity: 0.2; z-index: 200; position: fixed;" id="blocker"></div>').fadeIn(1e4)},removeBlocker:function(){$("#blocker").fadeOut(5e3)},getWGrroupNumbers:function(e,t,n){$("#pane-side").length>0?$('#main header [title="Menu"][role="button"]').length>0?($('#main header [title="Menu"][role="button"]').click(),setTimeout(function(){var e,t,a,s=$('#main header li[data-animate-dropdown-item="true"] [role="button"][title="Group info"]')||$('#main header li[data-animate-dropdown-item="true"] [role="button"][aria-label="Group info"]');0==s.length&&(s=$('#main header li[data-animate-dropdown-item="true"] [role="button"][aria-label="Group info"]')),0==s.length&&(s=$('ul li[data-animate-dropdown-item="true"] [role="button"][aria-label="Group info"]')),s.length>0&&s.parent().length>0?(s.parent().click(),$("body").click(),e=$("#main header span:eq(1)").attr("title"),t=$("#main header span:eq(2)").attr("title"),e&&t&&(a=[],t.split(",").filter(function(e){return!e.replace(/[^a-zA-Z]/g,"").trim()&&(a.push({Number:e}),!0)}),n({group_found:!0,whatsapp_web_open:!0}),sendMessage({command:"downloadGroupNumbers",data:a,group_name:e},function(e){}))):n({group_found:!1,whatsapp_web_open:!0})},100)):n({group_found:!1,whatsapp_web_open:!0}):n({group_found:!1,whatsapp_web_open:!1})},checkLastAttachment:async function(e,t,n){const s=getMyWPPhoneNumber();await smP(s.replace("+",""),"");const o=getLastAttachmentElement();if(o&&o.querySelector("[data-icon=forward-chat]")){var r=o.getAttribute("data-id")||"";sendMessage({command:"getSettings"},function(e){a.uiSettings=e.uiSettings;var t=a.uiSettings.lastAttachmentDataId||"";""!=t?r==t?n(!1):(a.uiSettings.lastAttachmentDataId=r,sendMessage({command:"saveUISettings",data:a.uiSettings},function(e){n(!0)})):(a.uiSettings.lastAttachmentDataId=r,sendMessage({command:"saveUISettings",data:a.uiSettings},function(e){n(!1)}))})}else n(!1)},openSelfChat:async function(e,t,n){const a=getMyWPPhoneNumber();await smP(a.replace("+",""),"")}};function sendMessage(e,t){null!=t&&(n.push(t),e.callback="yes"),chrome.runtime.sendMessage(e,t)}function console_logs_myApp(e,t){sendMessage({command:"console_logs_myApp",title:e,msg:t},function(e){})}function randomIntFromInterval(e,t){return Math.floor(Math.random()*(t-e+1)+e)}async function smP(e,t){let n=await randomDelay();return new Promise(async(a,s)=>{createMessageLink(e,t).then(()=>{setTimeout(async function(){let e=!1;""!=t&&(e=await clickSendButton()),a(e)},n)})})}async function clickSendButton(){let e=!1;return await findSendButton(),document.querySelector("[data-icon=send]")&&(document.querySelector("[data-icon=send]").click(),e=!0),e}async function findSendButton(){return new Promise((e,t)=>{var n=0,a=setInterval(function(){var t,s,o;n++,t=$("[data-icon=send]").is(":visible"),s=$('[data-animate-modal-popup="true"] [data-animate-modal-body="true"]').is(":visible"),o=$('[data-animate-modal-popup="true"] [data-animate-modal-body="true"] div:eq(0)').text(),1==t?(clearInterval(a),e()):1==s&&"Starting chat"!=o?(clearInterval(a),e()):n>=20&&(clearInterval(a),e())},500)},500)}function randomDelay(){return e==t?1e3*e:new Promise((n,a)=>{n(Math.floor(Math.random()*(1e3*t-1e3*e+1))+1e3*e)})}async function createMessageLink(e,t){return new Promise((n,a)=>{const s=encodeURIComponent(t),o=document.getElementById("blkwhattsapplink");if(o)o.setAttribute("href",`https://wa.me/${e}?text=${s}`);else{const t=`<a href="https://wa.me/${e}?text=${s}" id= "blkwhattsapplink"></a>`,n=$("#app .app-wrapper-web span");$(n[4]).html(t)}setTimeout(()=>{document.getElementById("blkwhattsapplink").click(),n()},1e3)})}function getLastAttachmentElement(){let e=null;const t=document.querySelectorAll(".message-out"),n=[];return t.forEach(e=>{isForwardable(e)&&n.push(e)}),n&&n.length>0&&(e=n[n.length-1]),e}function isForwardable(e){return!!e.querySelector('[data-icon="forward-chat"]')}async function forwardLastMsgtoPhone(e,t){let n=!1;if(await smP(e.replace("+",""),t)){const t=getTitleOnChatWindow(),a=getMyWPPhoneNumber();await smP(a,""),await openForwardModal();let s=await findForwardNodeUsingTitle(t);s||s||(s=await findForwardNodeUsingImage(e.replace("+",""))),s&&(clickOnForwardButton(),n=!0)}return n}async function clickOnForwardButton(){document.querySelector("[data-icon=send]")?await simulateMouseClick(document.querySelector("[data-icon=send]")):document.querySelector("[data-icon=send-light]")&&await simulateMouseClick(document.querySelector("[data-icon=send-light]"))}function findForwardNodeUsingImage(e){return new Promise(t=>{setTimeout(()=>{let n=null;document.querySelector("[data-animate-modal-body]").querySelectorAll("img").forEach(t=>{const a=t.getAttribute("src");if(a.match("&u=[0-9]+")){a.match("&u=[0-9]+")[0].substring(3).trim()===e.trim()&&(n=t)}}),n&&(n.click(),n=findParentBySelector(n,"._1Ux09")),t(n)},500)})}function getTitleOnChatWindow(){let e="";const t=document.querySelector('header [role="button"] [dir="auto"]');return t&&(e=t.getAttribute("title")),e}function findParentBySelector(e,t){for(var n=document.querySelectorAll(t),a=e.parentNode;a&&!collectionHas(n,a);)a=a.parentNode;return a}function collectionHas(e,t){for(var n=0,a=e.length;n<a;n++)if(e[n]==t)return!0;return!1}function findForwardNodeUsingTitle(e){let t=null,n=0;return document.querySelector("[data-animate-modal-body=true]").querySelectorAll("._1Ux09").forEach(a=>{if(0!==n){let n="";a.querySelector("._3q9s6 span[dir]")&&(n=a.querySelector("._3q9s6 span[dir]").getAttribute("title")),n.trim().toLowerCase()===e.trim().toLowerCase()?t=a:n.match(/[a-zA-Z]/)?n.trim().toLowerCase()===e.trim().toLowerCase()&&(t=a):n.replace(/[^A-Z0-9]/gi,"").trim()===e.trim()&&(t=a)}n++}),t||document.querySelector("[data-animate-modal-body]").querySelectorAll("._1Ux09 ._3vPI2 span[dir]").forEach(n=>{const a=n.getAttribute("title");a.trim().toLowerCase()===e.trim().toLowerCase()?t=n:a.match(/[a-zA-Z]/)?a.trim().toLowerCase()===e.trim().toLowerCase()&&(t=n):a.replace(/[^A-Z0-9]/gi,"").trim()===e.trim()&&(t=n)}),t||document.querySelector("[data-animate-modal-body]").querySelectorAll(".i5tg98hk[type='button'] [role='gridcell'] span[dir]").forEach(n=>{const a=n.getAttribute("title");a.trim().toLowerCase()===e.trim().toLowerCase()?t=n:a.match(/[a-zA-Z]/)?a.trim().toLowerCase()===e.trim().toLowerCase()&&(t=n):a.replace(/[^A-Z0-9]/gi,"").trim()===e.trim()&&(t=n)}),t&&(t.querySelector("._3q9s6 span[dir]")?t.querySelector("._3q9s6 span[dir]").click():t.click()),t}function simulateMouseClick(e){return new Promise((t,n)=>{["mouseover","mousedown","mouseup","click"].forEach(function(n){!function triggerMouseEvent(e,t){var n=document.createEvent("MouseEvents");n.initEvent(t,!0,!0),e.dispatchEvent(n)}(e,n),t()})})}async function openForwardModal(){return new Promise((e,t)=>{const n=getLastAttachmentElement();n?(n.querySelector("[data-icon=forward-chat]").click(),e()):e()})}function gmpn(){let e="";const t=document.querySelector("#side header img");if(t){const n=t.getAttribute("src");n.match("&u=[0-9]+")&&(e=n.match("&u=[0-9]+")[0].substring(3))}return e}function getMyWPPhoneNumber(){var e,t="";return""===gmpn()?((e=localStorage.getItem("last-wid")||"")||(e=localStorage.getItem("last-wid-md")||""),e&&-1!=e.indexOf("@")&&-1!=(t=e.split("@")[0]).indexOf('"')&&(t=t.split('"')[1])):t=gmpn(),t}function getFormattedTime(){var e=new Date,t=e.getHours(),n=t>=12?"pm":"am";return t=(t%=12)||12,pad((new Date).getDate())+"/"+pad((new Date).getMonth()+1)+"/"+(new Date).getUTCFullYear()+" "+pad(t)+":"+pad((new Date).getMinutes())+":"+pad((new Date).getSeconds())+" "+n}function pad(e){return e<10?"0"+e:e}chrome.runtime.onMessage.addListener(a.onExtMessage),$(document).ready(function(){sendMessage({command:"set_delay_in_bg",timeout:2e3},function(){a.load(),a.addEvents()},2e3)}),jQuery.fn.extend({vchange:function(){var e=document.createEvent("HTMLEvents");return e.initEvent("change",!1,!0),$(this).each(function(){$(this)[0].dispatchEvent(e)})},vclick:function(){var e=document.createEvent("HTMLEvents");return e.initEvent("click",!1,!0),$(this).each(function(){$(this)[0].dispatchEvent(e)})},vblur:function(){var e=document.createEvent("HTMLEvents");return e.initEvent("blur",!1,!0),$(this).each(function(){$(this)[0].dispatchEvent(e)})},vkeyup:function(){var e=document.createEvent("HTMLEvents");return e.initEvent("keyup",!1,!0),$(this).each(function(){$(this)[0].dispatchEvent(e)})},vmouseup:function(){var e=document.createEvent("MouseEvents");return e.initEvent("mouseup",!0,!0),$(this).each(function(){$(this)[0].dispatchEvent(e)})},vmousedown:function(){var e=document.createEvent("MouseEvents");return e.initEvent("mousedown",!0,!0),$(this).each(function(){$(this)[0].dispatchEvent(e)})},vTextEvent:function(){var e=new Event("input",{bubbles:!0});return $(this).each(function(){$(this)[0].focus(),$(this)[0].dispatchEvent(e)})}});